<div class="educational-container">
  <header class="educational-header">
    <h1>Conte√∫do Educacional</h1>
    <button class="btn-new-content" (click)="toggleForm()" [class.active]="showForm" *ngIf="isAdmin">
      <ng-container *ngIf="!showForm">
        <img src="assets/mais.svg" alt="Adicionar">
        <span>Novo conte√∫do</span>
      </ng-container>

      <ng-container *ngIf="showForm">
        <span>Cancelar</span>
      </ng-container>
    </button>
  </header>

  <!-- Formul√°rio de Novo/Editar Conte√∫do (apenas para admins) -->
  <div class="form-container" [class.show]="showForm" *ngIf="isAdmin">
    <h2>{{ isEditing ? 'Editar Conte√∫do' : 'Novo Conte√∫do' }}</h2>
    <form [formGroup]="contentForm" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <div class="form-group">
          <label for="title">T√≠tulo</label>
          <input type="text" id="title" formControlName="title" placeholder="Digite o t√≠tulo" required>
          <div class="error" *ngIf="contentForm.get('title')?.invalid && contentForm.get('title')?.touched">
            <span *ngIf="contentForm.get('title')?.hasError('required')">T√≠tulo √© obrigat√≥rio</span>
          </div>
        </div>

        <div class="form-group">
          <label for="category">Categoria</label>
          <select id="category" formControlName="category" required>
            <option value="">Selecione uma categoria</option>
            <option value="Investimentos">Investimentos</option>
            <option value="Educa√ß√£o Financeira">Educa√ß√£o Financeira</option>
            <option value="Planejamento">Planejamento</option>
            <option value="Economia">Economia</option>
            <option value="Renda Fixa">Renda Fixa</option>
            <option value="Renda Vari√°vel">Renda Vari√°vel</option>
            <option value="Criptomoedas">Criptomoedas</option>
            <option value="Fundos">Fundos</option>
          </select>
          <div class="error" *ngIf="contentForm.get('category')?.invalid && contentForm.get('category')?.touched">
            <span *ngIf="contentForm.get('category')?.hasError('required')">Categoria √© obrigat√≥ria</span>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="videoUrl">URL do V√≠deo (opcional)</label>
          <input type="url" id="videoUrl" formControlName="videoUrl" placeholder="https://youtube.com/watch?v=...">
          <div class="error" *ngIf="contentForm.get('videoUrl')?.invalid && contentForm.get('videoUrl')?.touched">
            URL inv√°lida
          </div>
        </div>

        <div class="form-group">
          <label for="fileUrl">URL do Arquivo (opcional)</label>
          <input type="url" id="fileUrl" formControlName="fileUrl" placeholder="https://exemplo.com/arquivo.pdf">
          <div class="error" *ngIf="contentForm.get('fileUrl')?.invalid && contentForm.get('fileUrl')?.touched">
            URL inv√°lida
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group full-width">
          <label for="description">Descri√ß√£o</label>
          <textarea id="description" formControlName="description" placeholder="Digite a descri√ß√£o do conte√∫do" required></textarea>
          <div class="error" *ngIf="contentForm.get('description')?.invalid && contentForm.get('description')?.touched">
            <span *ngIf="contentForm.get('description')?.hasError('required')">Descri√ß√£o √© obrigat√≥ria</span>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-submit" [disabled]="contentForm.invalid || loading">
          {{ loading ? (isEditing ? 'Atualizando...' : 'Salvando...') : (isEditing ? 'Atualizar Conte√∫do' : 'Salvar Conte√∫do') }}
        </button>
      </div>
    </form>

    <div class="error" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-container">
    <div class="filter-title">
      <h3>Filtrar conte√∫do</h3>
    </div>

    <div class="filter-controls">
      <div class="filter-group">
        <label>Categoria</label>
        <select [(ngModel)]="selectedCategory" (ngModelChange)="applyFilters()">
          <option value="">Todas as categorias</option>
          <option *ngFor="let category of uniqueCategories" [value]="category">
            {{ category }}
          </option>
        </select>
      </div>

      <div class="filter-group search-group">
        <label>Busca</label>
        <div class="search-input-wrapper">
          <input type="text" placeholder="Buscar conte√∫do" [(ngModel)]="searchTerm" (ngModelChange)="applyFilters()">
          <img src="assets/lupa.svg" alt="Buscar" class="search-icon">
        </div>
      </div>
    </div>
  </div>

  <!-- Grid de Conte√∫do -->
  <div class="content-section">
    <h3>Explore o conte√∫do educacional</h3>
    <p class="content-subtitle">{{ filteredContents.length }} conte√∫dos encontrados</p>

    <div *ngIf="filteredContents.length === 0" class="no-content">
      <div class="empty-state-icon">üìö</div>
      <p>Nenhum conte√∫do encontrado</p>
      <p *ngIf="isAdmin">Que tal adicionar o primeiro conte√∫do educacional?</p>
    </div>

    <div class="content-grid" *ngIf="filteredContents.length > 0">
      <div *ngFor="let content of filteredContents" class="content-card">
        <div class="card-header" [class.has-video]="content.videoUrl" (click)="openContentModal(content)">
          <span class="category-badge">{{ content.category }}</span>
          <div *ngIf="content.videoUrl" class="video-placeholder">üé¨</div>
          <div *ngIf="!content.videoUrl" class="content-icon">üìñ</div>
        </div>

        <div class="card-body">
          <h4 class="content-title">{{ content.title }}</h4>
          <p class="content-description">{{ content.description }}</p>

          <div class="card-actions" (click)="$event.stopPropagation()">
            <button class="btn-card-action btn-view" (click)="openContentModal(content)">
              Visualizar
            </button>
            <button class="btn-card-action btn-edit" (click)="editContent(content)" *ngIf="isAdmin">
              Editar
            </button>
            <button class="btn-card-action btn-delete" (click)="deleteContent(content.id)" *ngIf="isAdmin">
              Excluir
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Visualiza√ß√£o de Conte√∫do -->
  <div class="modal-overlay" *ngIf="showContentModal" (click)="closeContentModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">{{ selectedContent?.title }}</h2>
        <button class="modal-close" (click)="closeContentModal()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="selectedContent">
        <span class="modal-category">{{ selectedContent.category }}</span>
        
        <div class="modal-description">
          {{ selectedContent.description }}
        </div>

        <!-- V√≠deo do YouTube -->
        <iframe 
          *ngIf="selectedContent.videoUrl && getYouTubeEmbedUrl(selectedContent.videoUrl)"
          class="modal-video"
          [src]="getYouTubeEmbedUrl(selectedContent.videoUrl)"
          frameborder="0"
          allowfullscreen>
        </iframe>

        <!-- Links para recursos -->
        <div class="modal-links" *ngIf="selectedContent.videoUrl || selectedContent.fileUrl">
          <a 
            *ngIf="selectedContent.videoUrl" 
            [href]="selectedContent.videoUrl" 
            target="_blank" 
            class="btn-link">
            üé¨ Assistir V√≠deo
          </a>
          <a 
            *ngIf="selectedContent.fileUrl" 
            [href]="selectedContent.fileUrl" 
            target="_blank" 
            class="btn-link">
            üìÑ Download do Arquivo
          </a>
        </div>
      </div>
    </div>
  </div>
</div>